{% extends 'lead/lead_base.html' %}


{% block content %}
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"  crossorigin="anonymous"></script>




    <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
						<!--begin::Subheader-->
						<div  class="subheader py-6 py-lg-8 subheader-transparent" id="kt_subheader">
							<div class="container d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
								<!--begin::Info-->
								<div class="d-flex align-items-center flex-wrap mr-1">
									<!--begin::Page Heading-->
									<div class="d-flex align-items-baseline flex-wrap mr-5">
										<!--begin::Page Title-->
										<h5 class="text-dark font-weight-bold my-1 mr-5">Dashboard</h5>
										<!--end::Page Title-->
									</div>
									<!--end::Page Heading-->
								</div>
								<!--end::Info-->
								<!--begin::Toolbar-->
								<div class="d-flex align-items-center flex-wrap">
									<!--begin::Daterange-->
									<a href="#" class="btn btn-fixed-height btn-bg-white btn-text-dark-50 btn-hover-text-primary btn-icon-primary font-weight-bolder font-size-sm px-5 my-1 mr-3" id="kt_dashboard_daterangepicker" data-toggle="tooltip" title="Select dashboard daterange" data-placement="top">
										<span class="opacity-60 font-weight-bolder mr-2" id="kt_dashboard_daterangepicker_title">Today</span>
										<span class="font-weight-bolder" id="kt_dashboard_daterangepicker_date">Aug 16</span>
									</a>
									<!--end::Daterange-->
								</div>
								<!--end::Toolbar-->
							</div>
						</div>
						<!--end::Subheader-->
						<!--begin::Entry-->
						<div  class="d-flex flex-column-fluid">
							<!--begin::Container-->
							<div class="container">


   <div class="flex-row-fluid ml-lg-8">
										<!--begin::Card-->
										<div class="card card-custom card-stretch">
											<!--begin::Header-->
											<div class="card-header py-1">
												<div class="card-title align-items-start flex-column">
													<h3 class="card-label font-weight-bolder text-dark">Leave Apply</h3>
													<span class="text-muted font-weight-bold font-size-sm mt-1"></span>
												</div>
												<div class="card-toolbar">
													<button type="reset" class="btn btn-primary font-weight-bolder mr-2" id="leave_update">Apply</button>
													<button type="reset" class="btn btn-light-primary font-weight-bolder" onClick="window.location.reload();">Cancel</button>
												</div>
											</div>
											<!--end::Header-->
											<!--begin::Form-->
											<form method="POST">
												<!--begin::Body-->
                                                {% csrf_token %}
												<div class="card-body">
													<div class="row">
														<label class="col-xl-3"></label>
														<div class="col-lg-9 col-xl-6">
{#															<h5 class="font-weight-bold mb-6">Customer Info</h5>#}
														</div>
													</div>
												{% comment %}	<div class="form-group row">
														<label class="col-xl-3 col-lg-3 col-form-label text-right">Photo</label>
														<div class="col-lg-9 col-xl-6">
															<div class="image-input image-input-outline" id="kt_profile_avatar" style="background-image: url(assets/media/users/blank.png)">
																<div class="image-input-wrapper" style="background-image: url(assets/media/users/150-11.jpg)"></div>
																<label class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow" data-action="change" data-toggle="tooltip" title="" data-original-title="Change avatar">
																	<i class="fa fa-pen icon-sm text-muted"></i>
																	<input type="file" name="profile_avatar" accept=".png, .jpg, .jpeg" />
																	<input type="hidden" name="profile_avatar_remove" />
																</label>
																<span class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow" data-action="cancel" data-toggle="tooltip" title="Cancel avatar">
																	<i class="ki ki-bold-close icon-xs text-muted"></i>
																</span>
																<span class="btn btn-xs btn-icon btn-circle btn-white btn-hover-text-primary btn-shadow" data-action="remove" data-toggle="tooltip" title="Remove avatar">
																	<i class="ki ki-bold-close icon-xs text-muted"></i>
																</span>
															</div>
															<span class="form-text text-muted">Allowed file types: png, jpg, jpeg.</span>
														</div>
													</div>{% endcomment %}
                                                    {% for x in lead_name %}
                                                     <div style="display: none" class="form-group row">
														<label class="col-xl-3 col-lg-3 col-form-label text-right">Reason</label>
														<div class="col-lg-9 col-xl-6">
                                                        <input class="form-control form-control-lg form-control-solid" id="lead_name" value="{{ x.lead_empid }}" type="text"/>														</div>
													</div>
                                                    {% endfor %}
                                                    <div class="form-group row">
														<label class="col-xl-3 col-lg-3 col-form-label text-right">Reason</label>
														<div class="col-lg-9 col-xl-6">
															<textarea class="form-control form-control-lg form-control-solid" id="reason" type="text"></textarea>
														</div>
													</div>
													<div class="form-group row">
														<label class="col-xl-3 col-lg-3 col-form-label text-right">Days</label>
														<div class="col-lg-9 col-xl-6">
															<input class="form-control form-control-lg form-control-solid" id="leave_days" type="number"/>
															<span class="form-text text-muted">Enter Valid Format (Note * :  enter Half days as a 0.5 !)</span>
														</div>
													</div>
                                                    <div class="form-group row">
                                                        <label class="col-xl-3 col-lg-3 col-form-label text-right">Starting Day</label>
														<div class="col-lg-9 col-xl-6">
                                                            <input type="date" class="form-control form-control-lg form-control-solid" name="start_date" id="start_date" value="">
                                                        </div>
													</div>
                                                     <div class="form-group row">
                                                        <label class="col-xl-3 col-lg-3 col-form-label text-right">Ending Day</label>
														<div class="col-lg-9 col-xl-6">
                                                            <input type="date" class="form-control form-control-lg form-control-solid" name="end_date" id="end_date" value="">
                                                        </div>
													</div>
{#                                                    <div class="form-group row">#}
{#														<label class="col-xl-3 col-lg-3 col-form-label text-right">Description</label>#}
{#														<div class="col-lg-9 col-xl-6">#}
{#															<textarea class="form-control form-control-lg form-control-solid" id="description" type="text" ></textarea>#}
{#														</div>#}
{#													</div>#}
{#                                                    <div class="form-group row">#}
{#                                                        <label class="col-xl-3 col-lg-3 col-form-label text-right">Status</label>#}
{#                                                        <div class="col-lg-9 col-xl-6">#}
{#                                                            <select class="form-control form-control-lg form-control-solid" id="Billable_Status" name="Billable_Status" value="">#}
{#                                                                <option class="form-control form-control-lg form-control-solid">full day</option>#}
{#                                                                <option class="form-control form-control-lg form-control-solid">half day</option>#}
{#                                                            </select>#}
{#                                                         </div>#}
{#                                                </div>#}
                                                    <div>

                                                        <input class="form-control form-control-solid form-control-lg" value="{{ request.user.emp_id }}" id="emp_id" name="emp_id" type="hidden" placeholder="Current Password" />
                                                        <input class="form-control form-control-solid form-control-lg" value="{{ request.user.username }}" id="username" name="username" type="hidden" placeholder="Current Password" />
                                                    </div>
                                                </div>
											</form>

{% comment %}
                                              <form enctype='multipart/form-data' action="scanning_process" method='POST' class="dropzone dz" id="mydropzone"  >
                                                {% csrf_token %}
                                             <div class="fallback">
                                                 <input name="file" type="file"  multiple />
                                                 </div>

                                    </form>{% endcomment %}
											<!--end::Form-->
										</div>
									</div>



								<!--begin::Dashboard-->
								<!--begin::Row-->
								<!--end::Dashboard-->
							</div>
							<!--end::Container-->
						</div>
						<!--end::Entry-->




					</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.0/jquery.min.js"></script>

    <script src="https://momentjs.com/downloads/moment.js"></script>
<script src="http://isaaccambron.com/twix.js/twix.js/dist/twix.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twix.js/0.1.5/twix.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.30.1/date_fns.js"></script>
<script>
 $(document).ready(function(){

    $(document).on('click', '#leave_update', function(){

        var time=new Date();
        var current_time=time.getHours()+":"+time.getMinutes()+" "+time.getDate()+"-"+(time.getMonth()+1)+"-"+time.getFullYear();
        var emp_id = $("#emp_id").val();
        var username = $("#username").val();
        var reason = $("#reason").val();
        var leave_days = $("#leave_days").val();
        var start_date = $("#start_date").val();
        var end_date = $("#end_date").val();
        {#var description = $("#description").val();#}
         var leadname =  'admin';
        var status = 'request';
        
        if(leadname == undefined){
                     Swal.fire({
                         title: "error",
                         text: "pls contact admin to assign ur lead",
                         icon: "info",
                         showConfirmButton: false,
                         timer: 2000
                     })
            }else{

          if(reason =="" || start_date =="" || end_date =="" ){
                    Swal.fire({
                         title: "error",
                         text: "complete all fields....!",
                         icon: "info",
                         showConfirmButton: false,
                         timer: 1500
                     })

        }else{

            $.ajax({
                type: "POST",
                url: "{%  url 'leave_apply_post' %}",
                data:{
                     emp_id:emp_id,
                    username: username,
                    reason:reason,
                    leave_days: leave_days,
                    start_date:start_date,
                    end_date:end_date,
                    {#description:description,#}
                    leadname:leadname,
                    current_time:current_time,
                    status:status,
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
                },
                success: function (html){
                                  Swal.fire({
                                    title: "Success",
                                    text: "Successfully Applied...!",
                                    icon: "success",
                                    showConfirmButton: false,
                                    timer:1500
                                }).then(function () {
                                 window.location.href='{% url "lead_leave_apply_table" %}' ;
                                });
                // $("#cloc").removeAttr("disabled", "disabled");
            },
                error:function (){
                    alert("error");
                }
            });
          }
            }

    });
});


{% comment %}

 const addDays = (date, days = 1) => {
  const result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
};

const dateRange = (start, end, range = []) => {
  if (start > end) return range;
  const next = addDays(start, 1);
  return dateRange(next, end, [...range, start]);
};

var from = $("#start_date").val();
var to = $("#end_date").val();
const range = dateRange(new Date("2014-02-27"), new Date("2014-03-02"));

{#console.log(range);#}
console.log(range.map(date => date.toISOString().slice(0, 10)))







const { format, differenceInDays, addDays } = dateFns;

const getRangeDates = (startDate, endDate) => {
  const days = differenceInDays(endDate, startDate);
  console.log([...Array(days + 1).keys()].map((i) => format(addDays(startDate, i), 'YYYY-MM-DD')));
};

var date1 = $("#start_date").val();
var date2 = $("#end_date").val();
getRangeDates(date1, date2);

{#const { format, differenceInDays, addDays } = dateFns;#}
{##}
{#const getRangeDates = (startDate, endDate) => {#}
{#  const days = differenceInDays(endDate, startDate);#}
{#  console.log([Array(days + 1).keys()].map((i) => format(addDays(startDate, i), 'YYYY-MM-DD')));#}
{# };#}
{##}
{#var date1 = $("#start_date").val();#}
{#var date2 = $("#end_date").val();#}
{#console.log(date1)#}
{#console.log(date2)#}
{#getRangeDates(date1, date2);#}
{##}




// Returns an array of dates between the two dates
function getDates (startDate, endDate) {
  const dates = []
  let currentDate = startDate
  const addDays = function (days) {
    const date = new Date(this.valueOf())
    date.setDate(date.getDate() + days)
    return date
  }
  while (currentDate <= endDate) {
    dates.push(currentDate)
    currentDate = addDays.call(currentDate, 1)
  }
  return dates
}

// Usage
const dates = getDates(new Date(2013, 10, 22), new Date(2013, 11, 25))
dates.forEach(function (date) {
  {#console.log(date)#}
})


  var Day = 24*60*60*1000; // hours*minutes*seconds*milliseconds
var firstDate = new Date("2017-04-10");
var secondDate = new Date("2017-04-15");

var diffDays = (secondDate.getTime() - firstDate.getTime())/Day;
{#alert(diffDays);#}
for(var i=0;i<= diffDays ;i++)
{
   var d = new Date(firstDate  + i);
  console.log(d)
}



function getDatesInRange(startDate, endDate) {
  const date = new Date(startDate.getTime());

  // ✅ Exclude start date
  date.setDate(date.getDate() + 1);

  const dates = [];

  // ✅ Exclude end date
  while (date < endDate) {
    dates.push(new Date(date));
    date.setDate(date.getDate() + 1);
  }

  return dates;
}

const d1 = new Date('2022-01-18');
const d2 = new Date('2022-01-24');

console.log(getDatesInRange(d1, d2));







var dateString = 'November 21, 2018 - November 23, 2018'; // date received from $("#date_range").val()



{#var startDate = getDateYMD(dateString.split(' - ')[0]);  // return 2018-10-21#}
{#var endDate = getDateYMD(dateString.split(' - ')[1]);    // return 2018-10-23#}
{% endcomment %}


</script>

{% endblock content %}